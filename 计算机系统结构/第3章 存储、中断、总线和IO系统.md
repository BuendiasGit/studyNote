# 第三章 存储、中断、总线和I/O系统

## 3.1存储系统的基本要求和并行主存系统

### 3.1.1 存储系统的基本要求

对存储系统的基本要求是大容量、高速度和低价格。

存储器所用器件在一定条件下。容量越大，因延迟增大会使速度越低；容量越大，存储器的总价格会越大；存储器速度越快，价格也越高。

由于主存速度的改进跟不上CPU速度的提高，为了弥补CPU 与存储器在速度上的差异，一条途径使在组成上引入并行和重叠技术，构成并行主存系统。

### 3.2.1 并行主存系统

能并行独处多个CPU字的单体多姿和多体单字，多体多字的交叉访问主存系统被称为并行主存系统。

## 3.2 中断系统

### 3.2.1 中断系统的分类和分级

#### 1.中断的分类

IBM 370将中断分为机器校验、管理程序调用、程序性、外部、输入/输出和重新启动6类中断。

其中，输入/输出中断是CPU与I/O设备及通道联系的工具。

#### 2.中断的分级

同时发生多个中断请求，对中断请求的相应和处理的优先次序。

不同类的中断要根据中断的性质、紧迫性、重要性以及软件处理的方便性把它们分为不同的级别。

通常有限最高的中断定为1级中断，其次2级...

通常来说，机器校验中断为1级，程序性和管理程序调用为2级，外部为3级，I/O为4级，重新启动为最低级。

### 3.2.2 中断的相应次序与处理次序

中断相应的次序用排队器硬件实现，次序由高到低固定，很多计算机都设置了中断级屏蔽位寄存器，用来决定某级中断请求是否能进入中断相应排队器，只要能进入的，总是让高级别的优先响应。

要让各级中断处理次序和各级中断相应次序都一样即1->2->3->4，屏蔽位中，0是屏蔽，1是开放。中断系统一般由软硬件共同构成。

### 3.2.3 中断系统的软、硬件功能分配

中断系统主要是要由高的中断响应速度，其次是中断处理的灵活性，因此，中断系统的软、硬件功能分配实质上是中断处理程序软件和中断响应硬件的功能分配。

## 3.3 总线系统

### 3.3.1 总线的分类

总线在系统中的位置分为芯片级（CPU芯片内的总线）、板级（连接插件板内的各个组件，也称为局部总线或内部总线）和系统级（系统间或者主机与I/O接口之间的总线）。

就总线允许信息传送的方向来说，有单向传输和双向传输两种，双向传输有半双向和全双向的不同。

总线按用法分为专用和非专用两类

只连接一对物理不见的总线称为专用总线。优点是多个部件可以同时收发消息，不争用总线，系统流量高；通信时不同指明源和目的，控制简单；任何总线的失效只会使连接总线的两个部件不能直接通信，但它们仍然可以通过其他部件间接通信，因此系统可靠。

专用总线的缺点就是总线数多，成本高。

非专用总线可以被多种功能或多个部件分时共享，优点：总线数少，成本低；总线接口标准化、模块化强；可扩充能力强。缺点是系统流量小，经常会出现争用总线的情况。

### 3.3.2 总线的控制方式

集中式控制和分布式控制。

#### 集中式的控制方式

优先次序为串行链接、定时查询和独立请求三种方式。

串行链接方式获得使用总线权的优先次序是由“总线可用”线所接部件的物理位置决定，离总线控制器越近的优先级越高，优点是算法简单、部件增减容易。

集中式定时查询：总线上的每个部通过“总线请求”线发出请求，若总线处于空闲，“总线忙”信号未建立，总线控制器收到请求后，让计数器开始计数，定时查询各部件确定是谁发的请求。当查询线上的计数值与发送请求的部件号一致的时候，该部件建立“总线忙”。缺点是控制线多需要2+log2 N个，控制较为复杂。

集中式独立请求缺点：控制线数量过大，控制N个需要2N+1根控制线，且总线控制器要复杂得多。

集中式的控制方式，后两者用在高性能的巨、大、中型机上，小微型机用的最多的还是串行链接的方式。

### 3.3.3 总线的通信技术

同步通信、异步通信

### 3.3.4 数据宽度与总线线数

##### 1.数据宽度

是I/O设备取得I/O总线后传送数据的总量。数据通路宽度是数据总线的物理宽度，即一个时钟周期所传送的信息量。采用何种数据宽度，与总线上各设备的特点、所用总线控制方式和通信技术有关。

定长块宽度适合于磁盘等高速设备。

可变长快宽度适合用于高优先级的中高速磁带、磁盘等设备。

##### 2.总线线数

在满足性能前提下尽量减少线数，总线线数可以通过用线的组合、编码和并/串-串/并转换来减少，单一般会降低总线流量。

总线标准一般包括机械、功能、电器和过程四个方面的标准。

## 3.4 I/O系统

### 3.4.1 I/O系统概述

包括输入输出设备、设备控制器和输入输出相关的软硬件。

输入输出系统发展经历了三个阶段

程序控制I/O、直接存储器访问（DMA）和I/O处理机方式

对于I/O处理机方式分为通道方式（Channel）和外围处理机方式（PPU）

通道可看作“处理机”，有自己的指令系统（通道指令）和程序（通道程序）。

通道并不是独立的处理及。外围处理及则是一种独立性、通用性和功能都较强的处理机。

输入输出设备分外存和传输设备。

### 3.4.2 通道处理机的工作原理和流量设计

#### 1.工作原理

中央处理器用来控制外围设备操作用的输入输出指令被定义为管态指令

"启动I/O"指令是主要的输入输出指令,属于管态指令.

### 有大题

